# BookForm 통합 및 도서 수정 기능 구현

## 작업 일자
2025년 11월 3일

## 작업 내용

### 1. BookForm 컴포넌트 리팩토링
**파일**: `app/components/book-form.tsx`

#### 변경 사항
- `mode` prop 추가: `'new' | 'edit'` 타입으로 생성/수정 모드 구분
- `bookData` prop 추가: 수정 모드일 때 기존 도서 데이터 전달
- 모든 input 필드에 `defaultValue` 추가하여 수정 시 기존 값 표시
- `handleSubmit` 함수에서 mode에 따라 `createBook` 또는 `updateBook` 호출
- 버튼 텍스트 동적 변경 (Create/Update, Creating.../Updating...)
- 에러 메시지 동적 생성

### 2. Server Action 추가
**파일**: `app/actions/book-actions.ts`

#### 추가된 함수: updateBook
- PUT 메서드로 API 서버에 도서 수정 요청
- 성공 시 `updateTag('all-books')` 호출하여 캐시 무효화
- 에러 처리 포함

### 3. 도서 수정 페이지 생성
**파일**: `app/allbooks/editbook/[id]/page.tsx` (신규 생성)

#### 구조
- **동적 라우트**: `[id]` 사용하여 도서 ID 기반 라우팅
- **Server Component**: 서버에서 도서 데이터 fetch
- **getBook 함수**: API에서 특정 도서 데이터 가져오기
- **notFound 처리**: 도서가 없을 경우 404 페이지 표시

## 기술적 특징

### 1. Mode Pattern 사용
- `mode` prop을 사용하여 하나의 컴포넌트로 생성/수정 기능 모두 처리
- 코드 중복 제거 (DRY 원칙)
- 유지보수성 향상

### 2. defaultValue vs value
- **defaultValue 사용**: 비제어 컴포넌트 방식
  - 초기값만 설정하고 이후 React가 관리하지 않음
  - 성능상 유리
  - 폼 제출 시 FormData로 값 수집

### 3. TypeScript 타입 안정성
- `BookFormProps` 타입 정의
- `mode`는 리터럴 타입으로 제한
- `bookData`는 optional로 설정

### 4. Next.js 15+ 패턴
- `params`를 Promise로 처리
- Server Component에서 직접 데이터 fetch
- `notFound()` 함수로 404 처리

## 사용 방법

### 신규 도서 생성
```
<BookForm mode='new' />
```

### 기존 도서 수정
```
<BookForm mode='edit' bookData={book} />
```

## 라우팅 구조

```
/allbooks/newbook          → 신규 도서 생성
/allbooks/editbook/[id]    → 도서 수정 (동적 라우트)
```

## 캐시 전략

- `updateBook` 실행 후 `updateTag('all-books')` 호출
- 홈페이지 및 도서 목록 페이지의 캐시 자동 무효화
- `router.refresh()`로 클라이언트 측 데이터 갱신

## 테스트 시나리오

1. 신규 도서 생성 (기존 기능)
2. 도서 목록에서 수정 버튼 클릭
3. 수정 페이지에서 기존 데이터 표시
4. 데이터 수정 후 제출
5. 홈페이지로 리다이렉트 및 변경사항 반영
6. 존재하지 않는 ID로 접근 시 404 표시
